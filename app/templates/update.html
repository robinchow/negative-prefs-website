<!DOCTYPE html>
<html>
  <head>
    <!--Import Google Icon Font-->
    <link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" type="image/png" href="images/broken_heart.png" />
  </head>

  <body class="container">
    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

    <div class="row">
      <div class="col s12">
      <form id="update-form" action="#">
		<h4>{{ person }}</h4>
		<p>
        <input name="pref" type="radio" id="pref1" value="hates" />
        <label class="red-text" for="pref1">Hates</label>
		</p>
		<p>
        <input name="pref" type="radio" id="pref2" value="likes" />
        <label class="light-green-text" for="pref2">Likes</label>
        </p>
            <input type="text" id="thing" name="thing" placeholder="thing">
        <input type="hidden" name="action" value="add">
        <button class="btn waves-effect waves-light" type="submit" name="action">Add
            <i class="material-icons right">send</i>
        </button>
      </form>
      </div>
    </div>
    <div class="row">
      <div class="col s12">
        <ul class="collapsible" data-collapsible="accordion">
          <li>
            <div class="collapsible-header">
              Database
            </div>
            <div class="collapsible-body">
              <pre id="db-json" style="font-family:Courier,monospace;"></pre>
            </div>
          </li>
        </ul>
      </div>
    </div>

    <div class="row">
    <a href="/">Home</a>
    </div>

    <script type="text/javascript">
    function refresh_db_display() {
        $.get("get_db", function (data) {
            console.log('db', data);
            $('#db-json').text(JSON.stringify(data, null, 2));
        });
    }

    $("#update-form").submit(function (e) {
        e.preventDefault();
        e.stopPropagation();
        var $elem = $(e.target);
        var updateObj = {};
        $.each($elem.serializeArray(), function (i, field) {
            updateObj[field.name] = field.value;
        });
        var json = JSON.stringify(updateObj);
        console.log(updateObj, json);
        $.ajax({
            accepts: "application/json",
            contentType: "application/json",
            type: "POST",
            url: "update",
            data: json,
            success: function (data) {
                console.log("server returned", data);
                refresh_db_display();
            }
        });
        $("#thing").val("");
    });
    
    refresh_db_display();
    </script>
  </body>
</html>

